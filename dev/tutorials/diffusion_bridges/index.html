<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Sampling of diffusion bridges · DiffusionDefinition.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DiffusionDefinition.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">DiffusionDefinition.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../get_started/package_overview/">Get started</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">User manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/defining_diffusions/">Defining diffusions</a></li><li><a class="tocitem" href="../../manual/drift_and_volatility/">Drift and volatility</a></li><li><a class="tocitem" href="../../manual/sampling/">Sampling trajectories</a></li><li><a class="tocitem" href="../../manual/functionals_of_paths/">Computing path-functionals</a></li><li><a class="tocitem" href="../../manual/load_diff/">Loading diffusions</a></li><li><a class="tocitem" href="../../manual/convenience_functions/">Utility functions</a></li><li><a class="tocitem" href="../../manual/buffers/">Buffers</a></li><li><a class="tocitem" href="../../manual/state_space/">State space restrictions</a></li><li><a class="tocitem" href="../../manual/reparameterization/">Reparameterizations</a></li><li><a class="tocitem" href="../../manual/conjugate_updates/">Conjugate updates</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How to...</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../how_to_guides/sample_brownian_bridges/">How to sample Brownian bridges?</a></li><li><a class="tocitem" href="../../how_to_guides/sample_diffusion_bridges/">How to sample Diffusion bridges?</a></li><li><a class="tocitem" href="../../how_to_guides/sample_complex_valued/">How to sample complex-valued diffusions?</a></li><li><a class="tocitem" href="../../how_to_guides/customize_my_diffusion_plots/">How to customize plots of diffusion trajectories?</a></li><li><a class="tocitem" href="../../how_to_guides/expect_of_gradient/">How to compute expectation of gradients of functionals?</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox" checked/><label class="tocitem" for="menuitem-5"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../swinging_pendulum/">Defining a diffusion process for a swinging pendulum</a></li><li><a class="tocitem" href="../in_place_vs_out_of_place/">(TODO) In-place vs out-of-place methods</a></li><li class="is-active"><a class="tocitem" href>Sampling of diffusion bridges</a><ul class="internal"><li><a class="tocitem" href="#Why-is-there-so-much-text-in-this-tutorial?-1"><span>Why is there so much text in this tutorial?</span></a></li><li><a class="tocitem" href="#Rejection-sampling-1"><span>Rejection sampling</span></a></li><li><a class="tocitem" href="#Rejection-sampling-on-a-path-space-1"><span>Rejection sampling on a path space</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Predefined Diffusions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../predefined_processes/lotka_volterra/">Lotka-Volterra system</a></li><li><a class="tocitem" href="../../predefined_processes/sine/">Sine diffusion</a></li><li><a class="tocitem" href="../../predefined_processes/sir/">SIR model</a></li><li><a class="tocitem" href="../../predefined_processes/lorenz63/">Lorenz63 system</a></li><li><a class="tocitem" href="../../predefined_processes/lorenz96/">Lorenz96 system</a></li><li><a class="tocitem" href="../../predefined_processes/favetto_samson/">Favetto-Samson model</a></li><li><a class="tocitem" href="../../predefined_processes/prokaryote/">Prokaryotic autoregulatory gene network</a></li><li><a class="tocitem" href="../../predefined_processes/fitzhugh_nagumo/">FitzHugh-Nagumo model</a></li><li><a class="tocitem" href="../../predefined_processes/jansen_rit/">Jansen-Rit model</a></li></ul></li><li><a class="tocitem" href="../../post_index/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Sampling of diffusion bridges</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Sampling of diffusion bridges</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaDiffusionBayes/DiffusionDefinition.jl/blob/master/docs/src/tutorials/diffusion_bridges.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="tutorial_sampling_diff_bridges-1"><a class="docs-heading-anchor" href="#tutorial_sampling_diff_bridges-1">Sampling of diffusion bridges</a><a class="docs-heading-anchor-permalink" href="#tutorial_sampling_diff_bridges-1" title="Permalink"></a></h1><hr/><blockquote><p>In this tutorial we will illustrate how to sample diffusion bridges using rejection sampling, as well as importance sampling with Brownian bridge proposals. We will illustrate the techniques on the examples of a bivariate double-well potential and the Heston model.</p></blockquote><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Sampling of diffusion bridges using rejection sampling or importance sampling with Brownian bridge proposals <strong>is—in general—not an efficient method, and often, it is not even applicable for plenitude of problems</strong>. It is, however, an excellent starting point for learning about simulation of conditioned diffusions. The tutorial is meant as a didactic explanation of the common mechanisms behind most samplers of conditioned diffusions. Nevertheless, it is NOT meant to be used for production purposes. For that we refer the user to <a href="https://juliadiffusionbayes.github.io/GuidedProposals.jl/dev/">GuidedProposals.jl</a>, which has been designed to specifically address the problem of sampling conditioned diffusions.</p></div></div><h2 id="Why-is-there-so-much-text-in-this-tutorial?-1"><a class="docs-heading-anchor" href="#Why-is-there-so-much-text-in-this-tutorial?-1">Why is there so much text in this tutorial?</a><a class="docs-heading-anchor-permalink" href="#Why-is-there-so-much-text-in-this-tutorial?-1" title="Permalink"></a></h2><hr/><p>Sampling of diffusion bridges might seem like an innocent problem if you haven&#39;t seen it before. It is however a considerable obstacle that many mathematicians, statisticians and physicists have been attacking for tens of years. And for good reasons—efficient methods that solve this problem are considered to be extremely valuable tools for a variety of real-world applications. No universal solution has been found, however, there are a few contending methodologies that perform particularly well across a variety of problems of this kind. Many methodologies are far too complicated to explain them in a single tutorial. Fortunately, simple versions of rejection and importance sampling fit the bill. Even these however require from us to cover some additional details. Hence the length of the tutorial.</p><h2 id="Rejection-sampling-1"><a class="docs-heading-anchor" href="#Rejection-sampling-1">Rejection sampling</a><a class="docs-heading-anchor-permalink" href="#Rejection-sampling-1" title="Permalink"></a></h2><hr/><p>Rejection sampling is a simple, but extremely powerful technique for obtaining independent samples from some probability law <span>$\mathbb{P}$</span> (with density <span>$\dd \mathbb{P}$</span>) using independent samples from another probability law <span>$\mathbb{Q}$</span> (with density <span>$\dd \mathbb{Q}$</span>). You may, for instance, check out the <a href="https://en.wikipedia.org/wiki/Rejection_sampling">wikipedia article</a> to learn more.</p><p>The basic algorithm is as follows:</p><pre><code class="language-julia">struct RejectionSampling end
# these need to be appropriately defined
function density(P, at=x) ... end
function some_max_bound_on_dP_over_dQ(P, Q) ... end
P, Q = ...

function rand(P, Q, ::RejectionSampling)
    M = some_max_bound_on_dP_over_dQ(P, Q)
    while true
        X° = rand(Q) # proposal
        acceptance_prob = density(P, at=X) / (density(Q, at=X) * M)
        # accept/reject; if reject then re-sample and retry; if accept then return X°
        if rand() ≦ acceptance_prob
            return X°
        end
    end
end</code></pre><p>A sample returned by the algorithm above:</p><pre><code class="language-julia">X = rand(P, Q, RejectionSampling())</code></pre><p>is distributed exactly according to <span>$\mathbb{P}$</span> even though all sampling was done exclusively through the law <span>$\mathbb{Q}$</span>.</p><div class="admonition is-success"><header class="admonition-header">Definition</header><div class="admonition-body"><p>The law <span>$\mathbb{P}$</span> is called the <strong>target</strong> law, whereas <span>$\mathbb{Q}$</span> is called the <strong>proposal</strong> law.</p></div></div><h2 id="Rejection-sampling-on-a-path-space-1"><a class="docs-heading-anchor" href="#Rejection-sampling-on-a-path-space-1">Rejection sampling on a path space</a><a class="docs-heading-anchor-permalink" href="#Rejection-sampling-on-a-path-space-1" title="Permalink"></a></h2><hr/><p>Rejection sampling on a path space is a fancy name for the algorithm above as applied to diffusion processes, i.e. when the laws <span>$\mathbb{P}$</span> and <span>$\mathbb{Q}$</span> are some diffusion laws.</p><p>Computation of each individual term in the <strong>acceptance probability</strong></p><pre><code class="language-julia">acceptance_prob = density(P, at=X) / (density(Q, at=X) * M)</code></pre><p>which in a mathematical notation becomes:</p><div>\[\frac{1}{M}\frac{\dd \mathbb{P}}{\dd \mathbb{Q}}(X)\]</div><p>is not possible when working with diffusion processes. Nevertheless, the overall term can sometimes be found.</p><div class="admonition is-info"><header class="admonition-header">Some mathematical details</header><div class="admonition-body"><p>In particular, let&#39;s assume that the target diffusion law is of the following form:</p><div>\[\begin{equation}\label{eq:target_rejection}
\dd X_t = α(X_t)\dd t + \dd W_t,\quad X_0=x_0, \quad t\in[0,T],
\end{equation}\]</div><p>with <span>$α:\RR^d→\RR^d$</span> (at least once continuously differentiable), a volatility coefficient given by the identity matrix and <span>$W$</span> denoting a <span>$d$</span>-dimensional Brownian motion. Additionally, let&#39;s assume that there exists a function <span>$A:\RR^d→\RR$</span> such that:</p><div>\[∇A(x) = α(x).\]</div><p>(We refer to <span>$A$</span> as a <strong>potential</strong> function). Then, if we let <span>$\mathbb{P}$</span> denote the law of \eqref{eq:target_rejection} conditioned on an end-point, i.e. of:</p><div>\[\dd X_t = α(X_t)\dd t + \dd W_t,\quad X_0=x_0,\quad X_T=x_T, \quad t\in[0,T],\]</div><p>and we let <span>$\mathbb{Q}$</span> denote the law of a <span>$d$</span>–dimensional Brownian bridge joining <span>$x_0$</span> and <span>$x_T$</span> on <span>$[0,T]$</span>, then the <strong>Radon–Nikodym derivative</strong> between the two is proportional to:</p><div>\[\begin{equation}\label{eq:rnd}
\frac{\dd \mathbb{P}}{\dd \mathbb{Q}}(X)\propto \exp\left\{- \int_0^Tϕ(X_t)\dd t \right\}\leq 1,
\end{equation}\]</div><p>where</p><div>\[\phi(x):=\frac{1}{2}\left[ \alpha&#39;\alpha + Δ A \right](x) - l.\]</div><p>and <span>$l$</span> is any constant, which we may take in particular to be</p><div>\[l\leq \inf_{x\in\RR^d}\left\{ \frac{1}{2}\left[ \alpha&#39;\alpha + Δ A \right](x) \right\},\]</div><p>with the infimum on the right is <strong>assumed to exist</strong>.</p></div></div><p>The main take-away message from the box above is that if the stochastic differential equation admits a nice enough expression \eqref{eq:target_rejection}, then it is possible to find a closed form formula for the computation of the acceptance probability</p><div>\[\frac{1}{M}\frac{\dd \mathbb{P}}{\dd \mathbb{Q}}(X),\]</div><p>and rejection sampling on a path space can be performed by simply repeatedly drawing from <span>$\mathbb{Q}$</span>–the law of Brownian bridges (<a href="../../how_to_guides/sample_brownian_bridges/#how_to_guides-1">see this how-to-guide</a> for more info)—and accepting the samples with probability proportional to \eqref{eq:rnd}.</p><div class="admonition is-info"><header class="admonition-header">Lamperti transformation</header><div class="admonition-body"><p>The restriction to identity matrix volatility coefficient may be slightly relaxed thanks to existence of Lamperti transformation, which allows one to transform a diffusion with a non-identity volatility coefficient to the one with identity volatility. This transform is applicable to all scalar diffusions, however, in multiple dimensions it is more restrictive. See [Ait Sahalia 2008] for more details.</p></div></div><h3 id="Example-1"><a class="docs-heading-anchor" href="#Example-1">Example</a><a class="docs-heading-anchor-permalink" href="#Example-1" title="Permalink"></a></h3><hr/><p>Let&#39;s look at a simple example of a bivariate double-well potential model solving the following SDE</p><div>\[\dd X_t = -\frac{1}{2}∇A(X_t)\dd t + \dd W_t,\quad X_0 = x_0,\quad t\in[0,T],\]</div><p>where</p><div>\[A(x) := ρ_1\left[ (x_2)^2 - μ_1 \right]^2 + ρ_2\left[ x_2 - μ_2 x_1 \right]^2,\]</div><p>and <span>$ρ_1,ρ_2,μ_1,μ_2&gt;0$</span> are parameters.</p><pre><code class="language-julia"></code></pre><p>Some tedious calculations reveal that:</p><pre><code class="language-julia"></code></pre><p>TBC</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../in_place_vs_out_of_place/">« (TODO) In-place vs out-of-place methods</a><a class="docs-footer-nextpage" href="../../predefined_processes/lotka_volterra/">Lotka-Volterra system »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 8 June 2020 08:12">Monday 8 June 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
